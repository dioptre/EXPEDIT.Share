(function(){



window.renderFunction['tiny-location'] = function (selected) {

    var json = selected.data('json');


    //     var link = "/share/Location/" + selectedData[i].refid;
    //     newContent += "<div class=\"locationpicker embed-media-article\"><p class=\"title\"><a href=\'" + link + "\'>" + selectedData[i].name + "</a></p></div>&nbsp;";

    var id = $(selected).attr('id');
    selected.append($('<div>').attr({
        id: 'map-' + id,
        class: 'tiny-map'
    }));
    selected.append($('<a>').attr({
        href: "/share/Location/" + json.refid,
    }).html(json.name));
    selected.append($('<br/>'));



}

window.renderFunction['tiny-location-trigger'] = function (selected) {
    var id = $(selected).attr('id');
    var json = $(selected).data('json');
    if (typeof json !== 'undefined' && json.geography !== 'undefined') {
        var lmap;
        Ember.RSVP.allSettled([deferredMap.promise]).then(function () {
            setTimeout(function () {
                lmap = SetupMap('map-' + id);
                //RedrawMap(lmap);
                var geoData = ParseGeographyData(json.geography);
                AddMarkerUnique(lmap, GetFirstLocation(geoData), true, json.name, json.refid);
                RefocusMap(lmap);
            }, 300);
        }).then(function () {
            setTimeout(function () {
                lmap.setZoom(15);
            }, 1000);
        });
    }
}


})()
(function () {
    
    // Template to convert JSON to html form...
    window.renderFunction['tiny-workflow'] = function (selected) {
        //console.log('wf rendered', selected);
        var data = selected.data('json');
        //var formID = 'frm-' + formData.id;

        //var $form = $('<form>').attr({
        //    id: formID
        //})

        //$.each(formData.fields, function (i, d) {
        //    var source = $("#temp-" + d.field_type).html();
        //    var template = Handlebars.compile(source);
        //    var html = template(d);
        //    $form.append(html);
        //})

        //$form.append($('<div>').attr({
        //    class: 'btn btn-primary tiny-form-submit'
        //}).html('submit'))
        //var form = $form[0].outerHTML;

        //var source = $("#form-tabs").html();
        //var template = Handlebars.compile(source);
        //var htmlTabs = template({ outlet: form, id: formID, heading: formData.heading });



        selected.append($('<div>').attr({
            id: 'wf-cv-' + data[0].refid,
            class: 'tiny-workflow-cover'
        }));
        selected.append('<h4>' + data[0].name +' Workflow</h4>');




    }


    window.renderFunction['tiny-workflow-trigger'] = function (selected) {
        var data = selected.data('json');

        var myView = App.WorkflowView.create({
            controller: App.WorkflowController.create({
                data: { outlet: selected.attr('id'), wfid: data[0].refid, wfname: data[0].name },
                selected: null
            })
        });

        App.Node.store.find('node', { id: null, groupid: myView.controller.data.wfid }).then(function (m) {
            Ember.run.scheduleOnce('afterRender', this, function () {
                myView.appendTo('#gout');
            });
        });
    }

    // This is extra code run inside tinymce to allow editing of the form
    window.renderFunction['tiny-workflow-editor'] = function (e) {
        //if (typeof e !== 'undefined' && typeof e.target !== 'undefined' && typeof e.target.editorContainer !== 'undefined' && e.target.editorContainer) {
        //    var currentDocument = $(tinymce.activeEditor.contentDocument);
        //    currentDocument.find('*').andSelf().filter('.tiny-workflow').each(function (i, selected) {
        //        var json = $(selected).data('json');
        //        var parent = $(e.currentTarget).closest('div[id="' + json.id + '"]');
        //        window.renderFunction['tiny-workflow'](parent);
        //    });
        //}
    }
           



})();
